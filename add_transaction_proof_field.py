#!/usr/bin/env python3
"""
Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ transaction_proof Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ WalletDepositRequest
ÙŠØ¬Ø¨ ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù…Ù† Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
"""

import sqlite3
import os

def add_transaction_proof_field():
    """Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ transaction_proof Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ wallet_deposit_request"""
    
    # Ù…Ø³Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    db_path = os.path.join('instance', 'es_gift.db')
    
    if not os.path.exists(db_path):
        print(f"âŒ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©: {db_path}")
        return False
    
    try:
        # Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        conn = sqlite3.connect(db_path)
        cursor = conn.cursor()
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        cursor.execute("""
            SELECT name FROM sqlite_master 
            WHERE type='table' AND name='wallet_deposit_request'
        """)
        
        if not cursor.fetchone():
            print("âŒ Ø¬Ø¯ÙˆÙ„ wallet_deposit_request ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯")
            return False
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø­Ù‚Ù„
        cursor.execute("PRAGMA table_info(wallet_deposit_request)")
        columns = [column[1] for column in cursor.fetchall()]
        
        if 'transaction_proof' in columns:
            print("âœ… Ø­Ù‚Ù„ transaction_proof Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„")
            return True
        
        # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        cursor.execute("""
            ALTER TABLE wallet_deposit_request 
            ADD COLUMN transaction_proof VARCHAR(300)
        """)
        
        # Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        conn.commit()
        print("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ transaction_proof Ø¨Ù†Ø¬Ø§Ø­")
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©
        cursor.execute("PRAGMA table_info(wallet_deposit_request)")
        columns = [column[1] for column in cursor.fetchall()]
        
        if 'transaction_proof' in columns:
            print("âœ… ØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚Ù„ Ø¨Ù†Ø¬Ø§Ø­")
            return True
        else:
            print("âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚Ù„")
            return False
            
    except sqlite3.Error as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: {e}")
        return False
        
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ Ø¹Ø§Ù…: {e}")
        return False
        
    finally:
        if conn:
            conn.close()

def main():
    """Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"""
    print("ğŸ”§ Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ transaction_proof...")
    print("-" * 50)
    
    if add_transaction_proof_field():
        print("-" * 50)
        print("ğŸ‰ ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!")
        print("ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª")
    else:
        print("-" * 50)
        print("âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")

if __name__ == "__main__":
    main()

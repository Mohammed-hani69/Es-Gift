# ๐ ูุธุงู ุงูุชุญูู ุจุงูุตูุญุงุช ุงููุชูุฏู - ุฏููู ุดุงูู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ูุชูุฏู ููุชุญูู ูู ุงููุตูู ููุตูุญุงุช ุจูุงุกู ุนูู ุงูุฃุฏูุงุฑ (Role-Based Page Access Control) ูููุฑ:

- **ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ**: ุฅูุดุงุก ูุชุนุฏูู ุฃุฏูุงุฑ ูุฎุชููุฉ ูุน ุตูุงุญูุงุช ูุฎุตุตุฉ
- **ุตูุงุญูุงุช ุงูุตูุญุงุช**: ุชุญุฏูุฏ ุงูุตูุญุงุช ุงููุณููุญ ููููุธู ุงููุตูู ุฅูููุง
- **ูุงุฌูุฉ ูุฑุฆูุฉ**: ุฃุฏูุงุช ุจุตุฑูุฉ ูุงุฎุชูุงุฑ ุงูุตูุญุงุช ูุงูุฃุฐููุงุช
- **ุฃูุงู ูุญูู**: ูุญุต ุงูุตูุงุญูุงุช ูู ุงูุฎุงุฏู ูุจู ุนุฑุถ ุฃู ุตูุญุฉ

## ๐๏ธ ุงููููู ุงูุชููู

### 1. ุงููููุงุช ุงูุฃุณุงุณูุฉ

#### `admin_pages.py`
- **ุงูุบุฑุถ**: ุชุนุฑูู ุฌููุน ุตูุญุงุช ููุญุฉ ุงูุชุญูู ุงููุชุงุญุฉ
- **ุงููุญุชูู**: ูุงููุณ ุดุงูู ุจุงูุตูุญุงุช ููุณูุฉ ููุฆุงุช
- **ุงููุฆุงุช ุงููุชุงุญุฉ**:
  - ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
  - ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู 
  - ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช
  - ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
  - ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ
  - ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ
  - ุฅุฏุงุฑุฉ ุงููุญุชูู
  - ุฅุนุฏุงุฏุงุช ุงููุธุงู
  - ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช

#### `employee_utils.py`
- **ุงูุบุฑุถ**: ุฏูุงู ุงูุชุญูู ูู ุงููุตูู ูุงูุฃูุงู
- **ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ**:
  - `requires_page_access()`: ุฏูููุฑูุชุฑ ููุชุญูู ูู ุตูุงุญูุฉ ุงููุตูู
  - `has_page_access()`: ูุญุต ุตูุงุญูุฉ ููุธู ูุตูุญุฉ ูุญุฏุฏุฉ

#### `models.py`
- **ุญูู ุฌุฏูุฏ ูู Role**: `allowed_pages` (TEXT) ูุญูุธ ุงูุตูุญุงุช ุงููุณููุญุฉ ุจุตูุบุฉ JSON

#### Templates ุงููุญุฏุซุฉ
- `templates/admin/roles.html`: ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ ูุน ุงุฎุชูุงุฑ ุงูุตูุญุงุช
- `templates/admin/employees.html`: ุนุฑุถ ุตูุงุญูุงุช ุงูููุธู ุนูุฏ ุงุฎุชูุงุฑ ุงูุฏูุฑ

### 2. ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
-- ุฌุฏูู ุงูุฃุฏูุงุฑ ูุญุฏุซ
CREATE TABLE role (
    id INTEGER PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    display_name VARCHAR(200) NOT NULL,
    description TEXT,
    is_admin BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    allowed_pages TEXT,  -- JSON array of allowed page routes
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## ๐ฏ ุงูุฃุฏูุงุฑ ุงูููุนุฑูููุฉ ูุณุจูุงู

### 1. ๐ ูุฏูุฑ ุนุงู (admin)
- **ุงูุตูุงุญูุงุช**: ูุตูู ูุงูู ูุฌููุน ุงูุตูุญุงุช (19 ุตูุญุฉ)
- **ุงูุงุณุชุฎุฏุงู**: ูุฏูุฑู ุงููุธุงู ูุงููุคุณุณูู

### 2. ๐ผ ูุฏูุฑ ูุจูุนุงุช (sales_manager)
- **ุงูุตูุญุงุช ุงููุณููุญุฉ**:
  - ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ
  - ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช ูุงููุฆุงุช
  - ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
  - ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
  - ุงูุชูุงุฑูุฑ
- **ุฅุฌูุงูู**: 6 ุตูุญุงุช

### 3. ๐ฐ ูุญุงุณุจ (accountant)
- **ุงูุตูุญุงุช ุงููุณููุญุฉ**:
  - ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ
  - ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ
  - ุฅุฏุงุฑุฉ ุงูุนููุงุช
  - ุฅุฏุงุฑุฉ ุงููุญุงูุธ
  - ุงููุนุงููุงุช ุงููุงููุฉ
  - ุงูุทูุจุงุช (ูููุฑุงุฌุนุฉ ุงููุงููุฉ)
  - ุงูุชูุงุฑูุฑ
- **ุฅุฌูุงูู**: 7 ุตูุญุงุช

### 4. ๐ง ุฎุฏูุฉ ุงูุนููุงุก (customer_support)
- **ุงูุตูุญุงุช ุงููุณููุญุฉ**:
  - ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ
  - ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
  - ุทูุจุงุช ุงูุชุญูู ูู ุงููููุฉ
  - ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
  - ุงููุนุงููุงุช
- **ุฅุฌูุงูู**: 5 ุตูุญุงุช

### 5. โ๏ธ ูุฏูุฑ ูุญุชูู (content_manager)
- **ุงูุตูุญุงุช ุงููุณููุญุฉ**:
  - ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ
  - ุฅุฏุงุฑุฉ ุงููุญุชูู
  - ุฅุฏุงุฑุฉ ุงูุชูุจููุงุช
  - ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช (ูููุญุชูู)
  - ุฅุฏุงุฑุฉ ุงููุฆุงุช
- **ุฅุฌูุงูู**: 5 ุตูุญุงุช

### 6. ๐ค ููุธู ุนุงุฏู (employee)
- **ุงูุตูุญุงุช ุงููุณููุญุฉ**:
  - ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ
  - ุนุฑุถ ุงูุทูุจุงุช (ูุฑุงุกุฉ ููุท)
  - ุนุฑุถ ุงููุณุชุฎุฏููู (ูุฑุงุกุฉ ููุท)
- **ุฅุฌูุงูู**: 3 ุตูุญุงุช

## ๐ง ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุฅุถุงูุฉ ุตูุงุญูุฉ ุตูุญุฉ ุฌุฏูุฏุฉ

```python
# ูู admin_routes.py
@admin.route('/new-feature')
@login_required
@requires_page_access('admin.new_feature')  # ุฅุถุงูุฉ ูุฐุง ุงูุฏูููุฑูุชุฑ
def new_feature():
    # ููุฏ ุงูุตูุญุฉ
    pass
```

### 2. ุฅุถุงูุฉ ุตูุญุฉ ุฌุฏูุฏุฉ ูู ุงููุงุฆูุฉ

```python
# ูู admin_pages.py
ADMIN_PAGES = {
    # ุงูุตูุญุงุช ุงูููุฌูุฏุฉ...
    'admin.new_feature': {
        'name': 'ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ',
        'description': 'ูุตู ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ',
        'category': 'system'
    }
}
```

### 3. ุฅูุดุงุก ุฏูุฑ ุฌุฏูุฏ

```python
from models import Role
import json

new_role = Role(
    name='custom_role',
    display_name='ุฏูุฑ ูุฎุตุต',
    description='ูุตู ุงูุฏูุฑ',
    is_admin=False,
    allowed_pages=json.dumps([
        'admin.dashboard',
        'admin.orders',
        'admin.users'
    ]),
    is_active=True
)
db.session.add(new_role)
db.session.commit()
```

### 4. ูุญุต ุตูุงุญูุฉ ูู ุงูููุฏ

```python
from employee_utils import has_page_access

if has_page_access(current_employee, 'admin.financial'):
    # ุงูููุธู ูู ุตูุงุญูุฉ ุงููุตูู ููุตูุญุฉ ุงููุงููุฉ
    pass
```

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ
- **ุดุจูุฉ ุตูุงุญูุงุช**: ุนุฑุถ ุงูุตูุญุงุช ูุฑุชุจุฉ ุญุณุจ ุงููุฆุงุช
- **ุงุฎุชูุงุฑ ูุฑุฆู**: checkboxes ููู ุตูุญุฉ ูุน ุงููุตู
- **ูุนุงููุฉ ููุฑูุฉ**: ุนุฑุถ ุงูุตูุงุญูุงุช ุงููุฎุชุงุฑุฉ ูุจู ุงูุญูุธ
- **ูุงุฌูุฉ ูุชุฌุงูุจุฉ**: ุชุนูู ุนูู ุฌููุน ุฃุญุฌุงู ุงูุดุงุดุงุช

### ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูููุธููู
- **ุนุฑุถ ุงูุฏูุฑ**: ุนุฑุถ ุฏูุฑ ุงูููุธู ุงูุญุงูู
- **ูุนุงููุฉ ุงูุตูุงุญูุงุช**: ุนุฑุถ ุงูุตูุญุงุช ุงููุณููุญุฉ ุนูุฏ ุงุฎุชูุงุฑ ุฏูุฑ
- **ุฅุดุงุฑุงุช ุจุตุฑูุฉ**: ุฃููุงู ูุฎุชููุฉ ููุฃุฏูุงุฑ ุงููุฎุชููุฉ

## โก ุงูุฃุฏุงุก ูุงูุฃูุงู

### ุงูุฃูุงู
- **ูุญุต ุฎุงุฏู**: ุฌููุน ุงููุญูุตุงุช ุชุชู ูู ุงูุฎุงุฏู
- **redirect ุขูู**: ุฅุนุงุฏุฉ ุชูุฌูู ููุตูุญุฉ ุงูููุงุณุจุฉ ุนูุฏ ุนุฏู ูุฌูุฏ ุตูุงุญูุฉ
- **ุณุฌู ุงููุดุงุทุงุช**: ุชุณุฌูู ุฌููุน ูุญุงููุงุช ุงููุตูู

### ุงูุฃุฏุงุก
- **JSON ุชุฎุฒูู**: ุงูุตูุญุงุช ุงููุณููุญุฉ ูุญููุธุฉ ูู JSON ููุณุฑุนุฉ
- **cache ุงูุฃุฏูุงุฑ**: ุงูุฃุฏูุงุฑ ูุญููุฉ ูุณุจูุงู ูุชูููู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ูุญุต ูุจูุฑ**: ุฅููุงุก ุงููุญุต ุนูุฏ ุฃูู ุฑูุถ

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
```bash
python test_page_access.py
```

### ุงุฎุชุจุงุฑ ูุฏูู
1. ุชุณุฌูู ุฏุฎูู ุจุญุณุงุจ ููุธู
2. ูุญุงููุฉ ุงููุตูู ูุตูุญุงุช ูุฎุชููุฉ
3. ุงูุชุฃูุฏ ูู ุฅุนุงุฏุฉ ุงูุชูุฌูู ุงูููุงุณุจุฉ

## ๐ ุงูุชุญุฏูุซ ูุงูุตูุงูุฉ

### ุฅุถุงูุฉ ุฃุฏูุงุฑ ุฌุฏูุฏุฉ
```bash
python update_roles_system.py
```

### ุฅุนุงุฏุฉ ุชุนููู ุงูุตูุงุญูุงุช
```python
# ุฅุนุงุฏุฉ ุชุนููู ุตูุงุญูุงุช ุฏูุฑ ูุนูู
role = Role.query.filter_by(name='role_name').first()
role.allowed_pages = json.dumps(['admin.dashboard', 'admin.users'])
db.session.commit()
```

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ**: ุฌููุน ุงูููุธููู ูุญุชุงุฌูู ุตูุงุญูุฉ `admin.dashboard`
2. **ุงููุฏูุฑูู ุงูุนุงููู**: ููู ูุตูู ูุงูู ุชููุงุฆูุงู ุจุบุถ ุงููุธุฑ ุนู `allowed_pages`
3. **ุงูููุธููู ุบูุฑ ุงููุดุทูู**: ูุง ูููููู ุงููุตูู ูุฃู ุตูุญุฉ
4. **ุงููุญุต ุงููุถุงุนู**: ูุชู ูุญุต ุงูุตูุงุญูุฉ ูู ุงูุฏูููุฑูุชุฑ ููู ุฏุงูุฉ ูููุตูุฉ ููุฃูุงู

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ

#### "ูุง ูููู ุงููุตูู ููุตูุญุฉ"
- ุชุฃูุฏ ูู ุฅุถุงูุฉ `@requires_page_access()` ูููุณุงุฑ
- ุชุฃูุฏ ูู ูุฌูุฏ ุงูุตูุญุฉ ูู `ADMIN_PAGES`
- ุชุฃูุฏ ูู ุตูุงุญูุฉ ุงูุฏูุฑ ููุตูุญุฉ

#### "ุฎุทุฃ ูู JSON"
- ุชุฃูุฏ ูู ุตุญุฉ ุตูุบุฉ `allowed_pages` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงุณุชุฎุฏู `json.dumps()` ุฏุงุฆูุงู ุนูุฏ ุงูุญูุธ

#### "ุงูููุธู ุบูุฑ ููุฌูุฏ"
- ุชุฃูุฏ ูู ูุฌูุฏ ุณุฌู ูู ุฌุฏูู `Employee` ูููุณุชุฎุฏู
- ุชุฃูุฏ ูู ุฑุจุท `user_id` ู `role_id` ุจุดูู ุตุญูุญ

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุงููุธุงู ุงูุฌุฏูุฏ ูููุฑ:
- โ **ุฃูุงู ูุญูู**: ูุญุต ุดุงูู ููุตูุงุญูุงุช
- โ **ูุฑููุฉ ุนุงููุฉ**: ุฅููุงููุฉ ุชุฎุตูุต ุงูุฃุฏูุงุฑ ุจุณูููุฉ  
- โ **ูุงุฌูุฉ ุณููุฉ**: ุฅุฏุงุฑุฉ ุจุตุฑูุฉ ููุตูุงุญูุงุช
- โ **ุฃุฏุงุก ููุชุงุฒ**: ุงุณุชุนูุงูุงุช ูุญุณูุฉ ูุชุฎุฒูู JSON
- โ **ูุงุจููุฉ ุงูุชูุณุน**: ุฅุถุงูุฉ ุตูุญุงุช ูุฃุฏูุงุฑ ุฌุฏูุฏุฉ ุจุณูููุฉ

ุชู ุชุทููุฑ ุงููุธุงู ููููู ุญูุงู ุดุงููุงู ูุฅุฏุงุฑุฉ ุตูุงุญูุงุช ุงููุตูู ูู ุชุทุจููุงุช ุงูููุจ ุงููุจูุฑุฉ.

# -*- coding: utf-8 -*-
"""
ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฅุตูุงุญ ุฃุฎุทุงุก ุงูุฌุฏุงูู
==========================================

ูุฐุง ุงูููู ูุญู ูุดุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุถูู ุงูุฃุนูุฏุฉ ุงูููููุฏุฉ

"""

import os
import sys
from datetime import datetime

# ุฅุถุงูุฉ ูุณุงุฑ ุงููุดุฑูุน ุฅูู Python path
project_root = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, project_root)

# ุงุณุชูุฑุงุฏ ุงูุชุทุจูู ูุงูููุงุฐุฌ
from app import create_app
from models import db, PaymentGateway, Currency, Category, Subcategory

def fix_database():
    """ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฅุถุงูุฉ ุงูุฃุนูุฏุฉ ุงูููููุฏุฉ"""
    app = create_app()
    
    with app.app_context():
        try:
            print("๐ง ุจุฏุก ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช...")
            
            # ุญุฐู ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ ูุฅุนุงุฏุฉ ุฅูุดุงุฆูุง
            print("๐๏ธ ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุฌุฏุงูู...")
            
            # ุญุฐู ุฌููุน ุงูุฌุฏุงูู
            db.drop_all()
            print("  โ ุชู ุญุฐู ุงูุฌุฏุงูู ุงููุฏููุฉ")
            
            # ุฅูุดุงุก ุฌููุน ุงูุฌุฏุงูู ูู ุฌุฏูุฏ
            db.create_all()
            print("  โ ุชู ุฅูุดุงุก ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ")
            
            print("โ ุชู ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ!")
            print("ุงูุขู ููููู ุชุดุบูู ููู init_sample_data.py ูุฅุถุงูุฉ ุงูุจูุงูุงุช")
            
        except Exception as e:
            print(f"โ ุฎุทุฃ ูู ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช: {str(e)}")
            raise

if __name__ == '__main__':
    print("๐๏ธ ุฃุฏุงุฉ ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ES-Gift")
    print("=" * 50)
    
    confirm = input("โ๏ธ ุชุญุฐูุฑ: ุณูุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ! ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ (y/n): ")
    if confirm.lower() in ['y', 'yes', 'ูุนู']:
        fix_database()
        print("\n" + "=" * 50)
        print("๐ ุชู ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ!")
        print("ุงูุชุงูู: python init_sample_data.py")
    else:
        print("ุชู ุฅูุบุงุก ุงูุนูููุฉ.")
